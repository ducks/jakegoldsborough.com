<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="fediverse:creator" content="@ducks@hachyderm.io">
    <link rel="me" href="https://hachyderm.io/@ducks" />
    <meta name="author" content="Jake Goldsborough">
    <meta
      name="description"
      content="A blog about NixOS, self-hosting, Rust projects, and other tech musings. Maybe some meatspace stuff as well."
    >
    <meta name="keywords" content="NixOS, Linux, Rust, self-hosting, programming, tech blog, OSS">
    <title>
      
      NixOS as a daily driver or Zero to Nixty, part 5&#x2F;? - QoL enhancements -
      

      Jake Goldsborough
    </title>

    <link rel="stylesheet" href="https://jakegoldsborough.com/css/style.css" />

    
    <link rel="icon" href="https://jakegoldsborough.com/images/favicon.png" />
  </head>
  <body>
    <header>
      <div class="theme-picker">
        <label aria-label="Dark theme">
          <input type="radio" name="theme" value="dark" />
          <span aria-hidden="true"></span>
        </label>
        <label aria-label="Light theme">
          <input type="radio" name="theme" value="light" />
          <span aria-hidden="true"></span>
        </label>
        <noscript>
          <label aria-label="Dark theme"><span aria-hidden="true">dark</span></label>
          <label aria-label="Light theme"><span aria-hidden="true">light</span></label>
        </noscript>
      </div>
      <h1>
        <a href="https://jakegoldsborough.com/resume">Jake Goldsborough</a>
      </h1>
      <nav>
        <a
          href="https://jakegoldsborough.com/blog"
          class="active"
        >Blog</a>
        <span>|</span>
        <a
          href="https://jakegoldsborough.com/resume"
          class=""
          >Resume</a>
        <span>|</span>
        <a
          href="https://jakegoldsborough.com/contact"
          class=""
          >Contact</a>
      </nav>
    </header>

    <main>
      
  
    <article>
      <h1>NixOS as a daily driver or Zero to Nixty, part 5&#x2F;? - QoL enhancements</h1>
      
        <p>
          Published July  7, 2025
        </p>
      
      <p>
        5 min read
      </p>

      
        <p>
          Tags:
          
            <a href="/tags/nixos">nixos</a>, 
          
            <a href="/tags/linux">linux</a>
          
        </p>
      

      <h3 id="recap">Recap</h3>
<p>In the last post, we successfully got our configuration stored in version control.
This will make it very simple to pass our config around if needed. We also
learned about Dotter, a dotfile configuration management tool, which we will
be using again today.</p>
<p>See that post <a href="/blog/content/nixos-daily-driver-4">here</a></p>
<h3 id="intro">Intro</h3>
<p>Today, we will be covering a few quality of life enhancements. Those will
include keyboard remapping and locking our screen after a certain amount of
idle time.</p>
<p>Quality of life enhancements are things that while not strictly necessary,
they make life much better.</p>
<h3 id="keyboard-remapping">Keyboard Remapping</h3>
<p>First, I'll show you how to remap keys. For me personally, this will include:</p>
<ul>
<li>Caps Lock -&gt; Esc when pressed</li>
<li>Caps Lock -&gt; Control when held (and another key is pressed)</li>
</ul>
<p>Caps Lock as Control when being held is a new change for me but I'm really
enjoying it. It has opened up many more keybind options for me.</p>
<p>This remapping will be done using "Interception Tools"</p>
<h4 id="interception-tools">Interception Tools</h4>
<p><a href="https://wiki.archlinux.org/title/Interception-tools">Interception Tools</a> is a
set of utilities to control and customize the behavior of keyboard input
mappings.</p>
<p>It works at a lower level than tools like <code>xcape</code> or <code>xmodmap</code> which makes it
one of the only options available for customizing keyboard behavior across
X11, Wayland, and the Linux console.</p>
<p>Below is an example of mine. It's stored in
<code>~/dotfiles/nixos/modules/interception-caps.nix</code>.</p>
<p>This config:</p>
<ul>
<li>enables the <code>services.interception-tools</code> module</li>
<li>adds a plugin called caps2esc</li>
<li>adds a <code>udevmonConfig</code> file</li>
</ul>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>{ config, pkgs, ...}:
</span><span>
</span><span>let
</span><span>  intercept = &quot;${pkgs.interception-tools}/bin/intercept&quot;;
</span><span>  uinput = &quot;${pkgs.interception-tools}/bin/uinput&quot;;
</span><span>in {
</span><span>  services.interception-tools = {
</span><span>    enable = true;
</span><span>    plugins = with pkgs; [
</span><span>      interception-tools-plugins.caps2esc
</span><span>    ];
</span><span>    udevmonConfig = &#39;&#39;
</span><span>      - JOB: &quot;${intercept} -g $DEVNODE |
</span><span>              ${pkgs.interception-tools-plugins.caps2esc}/bin/caps2esc -m 1 |
</span><span>              ${uinput} -d $DEVNODE&quot;
</span><span>        DEVICE:
</span><span>          EVENTS:
</span><span>            EV_KEY: [KEY_CAPSLOCK, KEY_ESC]
</span><span>    &#39;&#39;;
</span><span>  };
</span><span>}
</span></code></pre>
<p>Let's breakdown what's happening here.</p>
<ul>
<li>
<p><code>JOB</code> defines a processing pipeline for input events. Each matching device runs
this chain of commands.</p>
</li>
<li>
<p><code>${intercept} -g $DEVNODE</code> reads events from the input device</p>
<ul>
<li><code>intercept</code> is the main input capture tool</li>
<li><code>-g</code> ensures the device stays grabbed</li>
</ul>
</li>
<li>
<p><code>caps2esc -m 1</code> is what actually transform the Caps Lock input into our dual
behavior</p>
<ul>
<li>Tap/Press = Escape</li>
<li>Hold = Control</li>
<li>Note - Control is only emitted if another key is pressed. holding Caps Lock
will not simply emit Control</li>
</ul>
</li>
<li>
<p><code>${input} -d $DEVNODE</code> writes the transformed input back into the system using
<code>uinput</code> kernel device</p>
</li>
<li>
<p><code>DEVICE</code> block filters which devices this pipelines applies to.</p>
<ul>
<li><code>EV_KEY: [KEY_CAPSLOCK, KEY_ESC]</code> means this only runs for devices that emit
Caps Locks or Escape key events</li>
</ul>
</li>
</ul>
<p>In short, this config captures raw key events for Caps Lock and Escape,
transforms them using the caps2esc plugin, and injects the new behavior back
into the system -- all at a low level that works across Wayland, X11, and even
TTYs.</p>
<p>The above is stored in a separate NixOS module and then imported in my main
configuration:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>imports =
</span><span>  [ # Include the results of the hardware scan.
</span><span>    /etc/nixos/hardware-configuration.nix
</span><span>    /etc/nixos/modules/interception-caps.nix
</span><span>  ];
</span></code></pre>
<h3 id="idle-and-lock">Idle and Lock</h3>
<p>Next, we will set our machine up to first lock, then power the screen down after
a certain amount of idle time.</p>
<p>This is done using Hyprland companion packages, <code>hyprlock</code> and <code>hypridle</code>.</p>
<p>You can install those by adding them to your package list:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>environment.systemPackages = with pkgs; [
</span><span>  hypridle
</span><span>  hyprlock
</span><span>];
</span></code></pre>
<h4 id="hyperidle">Hyperidle</h4>
<p>Save this config as:
<code>~/dotfiles/hypr/hypridle.conf</code></p>
<p>Here is my current setup:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>general {
</span><span>    lock_cmd = hyprlock
</span><span>    before_sleep_cmd = hyprlock
</span><span>    after_sleep_cmd = hyprctl dispatch dpms on
</span><span>}
</span><span>
</span><span>listener {
</span><span>    timeout = 300
</span><span>    on-timeout = hyprlock
</span><span>}
</span><span>
</span><span>listener {
</span><span>    timeout = 330
</span><span>    on-timeout = hyprctl dispatch dpms off
</span><span>    on-resume = hyprctl dispatch dpms on
</span><span>}
</span><span>
</span></code></pre>
<p>This is telling <code>hypridle</code> to run <code>hyprlock</code> as the lock_cmd and right before sleep.
Then after we wake, use hyprctl to turn the monitor back on.</p>
<p>Then we set up a few simple listeners. The first one is for 300 seconds (5
minutes) and simply runs <code>hyprlock</code> on-timeout. Then, I have another for 330
seconds (5 minutes 30 seconds) that will shut my monitor off on-timeout, and turn
it back on after resuming.</p>
<p>Reload hypr conf with <code>hyprctl reload</code> and you should now have a functioning
idle and lock screen.</p>
<h4 id="hyperlock">Hyperlock</h4>
<p>Note: Hyprlock does not automatically create a config, and without one,
<code>hyprlock</code> will not render anything, meaning you will just see your screen, but
it will be locked -- you will not be able to interact with it again until you
enter your password and hit Enter.</p>
<p>We are also able to customize our lock screen some. This config will also
live in the same directory as the other hyprland config files.
<code>~/dotfiles/hypr/hyprlock.conf</code></p>
<p>Below is an example of mine. It looks similar to css styling but not exactly.</p>
<p>Here, I'm setting up a simple background color, an input field with a border,
and a label that just outputs the time. I like to keep mine simple but you can
add a background image, move the input box around, and do a lot more than I am.</p>
<p>You can find more in the docs
<a href="https://wiki.hypr.land/Hypr-Ecosystem/hyprlock/">here</a>. It covers all the
available elements you can use to style your Hyprlock screen.</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>background {
</span><span>    color = rgb(282828)  # Gruvbox dark background
</span><span>    blur_passes = 0
</span><span>}
</span><span>
</span><span>input-field {
</span><span>    font_color = rgb(ebdbb2)
</span><span>    inner_color = rgb(282828) # Slightly lighter than background
</span><span>    outer_color = rgb(928374)
</span><span>    outline_thickness = 3
</span><span>    size = 500, 50
</span><span>    position = 0, -33%
</span><span>}
</span><span>
</span><span>label {
</span><span>    text = cmd[update:1000] echo &quot;&lt;b&gt;&lt;big&gt; $(date +&quot;%H:%M:%S&quot;) &lt;/big&gt;&lt;/b&gt;&quot;
</span><span>    color = rgb(ebdbb2)
</span><span>    font_size = 32
</span><span>    position = 0, 0
</span><span>    valign = center
</span><span>    halign = center
</span><span>}
</span></code></pre>
<p>After adding both files, remember to run <code>dotter deploy</code>. This will add symlinks
for our newly added files to our correct Hyprland config directory by default
based on our Dotter config.</p>
<h3 id="fun-fact">Fun Fact</h3>
<p>This post was written from NixOS!</p>
<h3 id="summary">Summary</h3>
<p>In this post, we have:</p>
<ul>
<li>Configured some muscle memory engraved key remappings including:
<ul>
<li>Caps Lock -&gt; Esc when pressed</li>
<li>Caps Lock -&gt; Control when held (and another key is pressed)</li>
</ul>
</li>
<li>Setup <code>hypridle</code> to lock out computer after 5 minutes then turn the screen off
30 seconds after that.</li>
<li>Styled a simple <code>hyprlock</code> screen that shows the time and an input box for our
password</li>
</ul>
<h3 id="next-time">Next Time</h3>
<p>Next time will be all about development work. We will introduce Nixvim and
<code>nix shell</code>. Nix shells are development environments you can set up via config.
They are very powerful and make developing on NixOS much easier.</p>


      
        
        

        
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
                
                  
                
              
                
                  
                
              
                
                  
                
              
                
                  
                
              
                
              
                
                  
                
              
                
                  
                
              
                
                  
                
              
                
                  
                
              
                
                  
                
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
                
                  
                
              
                
                  
                
              
                
                  
                
              
                
              
                
                  
                
              
                
                  
                
              
                
                  
                
              
                
                  
                
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        

        
          <section class="related-posts">
            <h2>Related Posts</h2>
            <ul>
              
                <li>
                  <a href="https:&#x2F;&#x2F;jakegoldsborough.com&#x2F;blog&#x2F;2025&#x2F;nixos-daily-driver-9&#x2F;">NixOS as a daily driver or Zero to Nixty, part 9&#x2F;? - Enabling Wi-Fi</a>
                  <span class="post-date">July 27, 2025</span>
                </li>
              
                <li>
                  <a href="https:&#x2F;&#x2F;jakegoldsborough.com&#x2F;blog&#x2F;2025&#x2F;nixos-daily-driver-8&#x2F;">NixOS as a daily driver or Zero to Nixty, part 8&#x2F;? - Modular Config</a>
                  <span class="post-date">July 20, 2025</span>
                </li>
              
                <li>
                  <a href="https:&#x2F;&#x2F;jakegoldsborough.com&#x2F;blog&#x2F;2025&#x2F;nixos-daily-driver-7-5&#x2F;">NixOS as a daily driver or Zero to Nixty, part 7.5&#x2F;? - Trial by Encrypted Fire</a>
                  <span class="post-date">July 13, 2025</span>
                </li>
              
                <li>
                  <a href="https:&#x2F;&#x2F;jakegoldsborough.com&#x2F;blog&#x2F;2025&#x2F;nixos-daily-driver-6&#x2F;">NixOS as a daily driver or Zero to Nixty, part 6&#x2F;? - Dev environment</a>
                  <span class="post-date">July  8, 2025</span>
                </li>
              
                <li>
                  <a href="https:&#x2F;&#x2F;jakegoldsborough.com&#x2F;blog&#x2F;2025&#x2F;nixos-daily-driver-4&#x2F;">NixOS as a daily driver or Zero to Nixty, part 4&#x2F;? - dotfile&#x2F;config management</a>
                  <span class="post-date">June 27, 2025</span>
                </li>
              
            </ul>
          </section>
        
      
    </article>
  

    </main>

    <footer>
      <p><a href="https://jakegoldsborough.com/rss.xml">Subscribe via RSS</a></p>
    </footer>

    <script src="/js/main.js"></script>
    <script data-goatcounter="https://stats.jakegoldsborough.com/count"
        async src="//stats.jakegoldsborough.com/count.js"></script>
  </body>
</html>

